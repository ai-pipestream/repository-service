# Test-specific configuration
# This file overrides main/resources/application.properties for tests

# Disable MySQL DevServices - we use compose-test-services.yml
quarkus.datasource.devservices.enabled=false
quarkus.datasource.db-kind=mysql
quarkus.datasource.username=pipeline
quarkus.datasource.password=password
quarkus.datasource.jdbc.url=jdbc:mysql://localhost:3307/pipeline_repo_test

# Disable Kafka DevServices - we use compose-test-services.yml
quarkus.kafka.devservices.enabled=false

# HTTP/gRPC test configuration
quarkus.http.test-port=0
quarkus.grpc.server.use-separate-server=false

# Database schema management for tests
quarkus.hibernate-orm.schema-management.strategy=drop-and-create
quarkus.hibernate-orm.sql-load-script=import.sql
quarkus.flyway.migrate-at-start=false
quarkus.flyway.clean-at-start=true

# Docker Compose DevServices for test infrastructure
quarkus.devservices.enabled=true
quarkus.compose.devservices.files=../../src/test/resources/compose-test-services.yml
quarkus.compose.devservices.start-services=true
quarkus.compose.devservices.project-name=pipeline-test-services
quarkus.compose.devservices.stop-services=false
quarkus.compose.devservices.reuse-project-for-tests=true
quarkus.compose.devservices.stop-timeout=30s

# Kafka test configuration
kafka.bootstrap.servers=localhost:9095
mp.messaging.connector.smallrye-kafka.bootstrap.servers=localhost:9095
mp.messaging.connector.smallrye-kafka.apicurio.registry.url=http://localhost:8082/apis/registry/v3

# S3 (MinIO) test configuration
quarkus.s3.devservices.enabled=false
quarkus.kms.devservices.enabled=false
quarkus.s3.endpoint-override=http://localhost:9010
quarkus.s3.aws.region=us-east-1
quarkus.s3.aws.credentials.type=static
quarkus.s3.aws.credentials.static-provider.access-key-id=minioadmin
quarkus.s3.aws.credentials.static-provider.secret-access-key=minioadmin
quarkus.s3.path-style-access=true

# Disable service registration in tests
service.registration.enabled=false

# WireMock DevService for mocking external gRPC services (if needed in future)
# Currently disabled - let internal services call each other naturally
# quarkus.wiremock.devservices.enabled=true
# quarkus.wiremock.devservices.extension-scanning-enabled=true
# quarkus.wiremock.devservices.files-mapping=classpath:META-INF
# quarkus.wiremock.devservices.global-response-templating=true

# gRPC clients - filesystem-service is internal, so don't redirect to WireMock
# Let it use the main application.properties config (localhost:38101)
